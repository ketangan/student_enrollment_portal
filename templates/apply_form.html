{% load form_extras %}
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{{ school.display_name|default:school.slug }} - Apply</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin: 0; background: #f6f7fb; }
      header { padding: 20px; background: white; border-bottom: 1px solid #e5e7eb; }
      .brand { display: flex; align-items: center; gap: 12px; }
      .logo { width: 40px; height: 40px; border-radius: 10px; background: #e5e7eb; display:flex; align-items:center; justify-content:center; overflow:hidden; }
      .container { max-width: 900px; margin: 0 auto; padding: 20px; }
      .card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 18px; margin-bottom: 16px; }
      h1 { font-size: 18px; margin: 0; }
      h2 { font-size: 16px; margin: 0 0 10px; }
      .muted { color: #6b7280; }
      label { display:block; font-weight: 600; margin-bottom: 6px; }
      input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 14px; }
      textarea { min-height: 90px; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .field { margin-bottom: 14px; }
      .error { color: #b91c1c; font-size: 13px; margin-top: 6px; }
      .help { color: #6b7280; font-size: 13px; margin-top: 6px; }
      .submit { background: {{ branding.theme.accent_color }}; color: white; border: none; padding: 12px 16px; border-radius: 12px; font-weight: 700; cursor: pointer; }
      .required { color: #b91c1c; margin-left: 4px; }
      @media (max-width: 720px) { .row { grid-template-columns: 1fr; } }
    </style>
  </head>

  <body>
    <header>
      <div class="container">
        <div class="brand">
          <div class="logo">
            {% if branding.logo_url %}
              <img src="{{ branding.logo_url }}" alt="logo" style="width:100%; height:100%; object-fit:cover;" />
            {% else %}
              <span class="muted">üè´</span>
            {% endif %}
          </div>
          <div>
            <h1>{{ school.display_name|default:school.slug }}</h1>
            <div class="muted">{{ form.title }}</div>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      {% if form.description %}
        <div class="card">
          <div class="muted">{{ form.description }}</div>
        </div>
      {% endif %}

      <form method="post">
        {% csrf_token %}

        {% for section in form.sections %}
          <div class="card">
            <h2>{{ section.title }}</h2>
            {% if section.description %}
              <div class="muted" style="margin: 6px 0 14px;">{{ section.description }}</div>
            {% endif %}

            {% for field in section.fields %}
              <div class="field">
                <label for="{{ field.key }}">
                  {{ field.label }}
                  {% if field.required %}<span class="required">*</span>{% endif %}
                </label>

                {% if field.type == "textarea" %}
                  <textarea id="{{ field.key }}" name="{{ field.key }}" placeholder="{{ field.placeholder|default:'' }}">{{ values|get_item:field.key }}</textarea>

                {% elif field.type == "select" %}
                  <select id="{{ field.key }}" name="{{ field.key }}">
                    <option value="">Select...</option>
                    {% for opt in field.options %}
                      <option value="{{ opt.value }}" {% if values|get_item:field.key == opt.value %}selected{% endif %}>{{ opt.label }}</option>
                    {% endfor %}
                  </select>

                {% elif field.type == "multiselect" %}
                  <select id="{{ field.key }}" name="{{ field.key }}" multiple>
                    {% for opt in field.options %}
                      <option value="{{ opt.value }}">{{ opt.label }}</option>
                    {% endfor %}
                  </select>
                  <div class="help">Hold ‚åò (Mac) to select multiple.</div>

                {% elif field.type == "checkbox" %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="checkbox" {% if values|get_item:field.key %}checked{% endif %} />

                {% elif field.type == "email" %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="email" value="{{ values|get_item:field.key }}" />

                {% elif field.type == "phone" %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="tel" value="{{ values|get_item:field.key }}" />

                {% elif field.type == "date" %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="date" value="{{ values|get_item:field.key }}" />

                {% elif field.type == "number" %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="number" value="{{ values|get_item:field.key }}" />

                {% elif field.type == "file" %}
                  <!-- Uploads disabled in MVP (Phase 4-ready); keep placeholder -->
                  <div class="muted">File upload will be enabled in a later phase.</div>

                {% else %}
                  <input id="{{ field.key }}" name="{{ field.key }}" type="text" value="{{ values|get_item:field.key }}" />
                {% endif %}

                {% if field.help_text %}
                  <div class="help">{{ field.help_text }}</div>
                {% endif %}

                {% if errors|get_item:field.key %}
                  <div class="error">{{ errors|get_item:field.key }}</div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% endfor %}

        <div class="card">
          <button class="submit" type="submit">
            {{ form.submit_button_text|default:"Submit Application" }}
          </button>
        </div>
      </form>
    </div>
  </body>
</html>
